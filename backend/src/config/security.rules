(rules_version = '2';

service cloud.firestore {
	match /databases/{database}/documents {

		// users: each user can read their own document and create during registration
		match /users/{userId} {
			allow read: if request.auth.uid == userId;
			allow create: if request.auth.uid == userId || (request.auth.uid == request.resource.data.id);
			allow update: if request.auth.uid == userId;
		}

		// sensors: admin and operator can read
		match /sensors/{sensorId} {
			allow read: if request.auth != null && request.auth.token.role in ['admin', 'operator'];
			allow create, update: if request.auth != null && request.auth.token.role == 'admin';
			allow delete: if request.auth != null && request.auth.token.role == 'admin';
		}

		// measurements: any authenticated user can read and create
		match /measurements/{measurementId} {
			allow read: if request.auth != null;
			allow create: if request.auth != null;
		}
	}
})

